(()=>{var n={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return n.d(t,{a:t}),t},d:(o,t)=>{for(var r in t)n.o(t,r)&&!n.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:t[r]})},o:(n,o)=>Object.prototype.hasOwnProperty.call(n,o),r:n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},o={};(()=>{"use strict";function t(){return t=Object.assign||function(n){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},t.apply(this,arguments)}n.r(o);const r=flarum.core.compat["forum/app"];var a=n.n(r);const s=flarum.core.compat["common/extend"],e=flarum.core.compat["common/utils/humanTime"];var i=n.n(e);const c=flarum.core.compat["common/utils/extractText"];var u=n.n(c);const l=flarum.core.compat["common/components/Button"];var p=n.n(l);const f=flarum.core.compat["common/components/Link"];var d=n.n(f);const y=flarum.core.compat["common/components/Switch"];var h=n.n(y);const v=flarum.core.compat["common/components/Tooltip"];var k=n.n(v);const A=flarum.core.compat["common/Model"];var b=n.n(A);const g=flarum.core.compat["common/models/Post"];var w=n.n(g);const C=flarum.core.compat["forum/utils/DiscussionControls"];var x=n.n(C);const z=flarum.core.compat["forum/utils/PostControls"];var P=n.n(z);const O=flarum.core.compat["forum/components/CommentPost"];var U=n.n(O);const E=flarum.core.compat["forum/components/Composer"];var M=n.n(E);const N=flarum.core.compat["forum/components/DiscussionComposer"];var j=n.n(N);const D=flarum.core.compat["forum/components/ReplyComposer"];var S=n.n(D);const T=flarum.core.compat["forum/components/PostUser"];var _=n.n(T);const I=flarum.core.compat["forum/components/DiscussionListItem"];var L=n.n(I);const V=flarum.core.compat["forum/components/ReplyPlaceholder"];var B=n.n(V);function R(n){a().forum.attribute("canAnonymousPost")&&n.add("anonymous-posting",h().component({state:!!a().composer.fields.isAnonymous,onchange:function(n){a().composer.fields.isAnonymous=n}},m("span.AnonymousCheckboxLabel",[a().translator.trans("clarkwinkelmann-anonymous-posting.forum.composerControls.anonymize"),m(".helpText",a().translator.trans("clarkwinkelmann-anonymous-posting.forum.composerControls.anonymizeHelp"))])),-10)}function H(n){a().composer.fields.isAnonymous&&(n.isAnonymous=!0)}function $(n){a().composer.fields.isAnonymous&&n&&Array.isArray(n.children)&&n.children.forEach((function(n){n&&Array.isArray(n.children)&&n.children.forEach((function(o,t){o&&o.attrs&&o.attrs.className&&-1!==o.attrs.className.indexOf("ComposerBody-avatar")&&(n.children[t]=q(a().forum,".ComposerBody-avatar"))}))}))}function q(n,o){void 0===o&&(o="");var t=n.attribute("anonymousAvatarUrl");return t?m("img.Avatar.Avatar--anonymous"+o,{src:t,alt:a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username")}):m("span.Avatar.Avatar--anonymous"+o,a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.initials"))}a().initializers.add("anonymous-posting",(function(){(0,s.extend)(U().prototype,"headerItems",(function(n){var o=this,r=this.attrs.post;if(r.attribute("isAnonymous")&&(n.setContent("user",m(".PostUser",m("h3",[q(r,".PostUser-avatar"),m("span.username",a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username"))]))),b().hasOne("anonymousUser").call(r))){var s=new(w())(t({},r.data,{relationships:t({},r.data.relationships,{user:r.data.relationships.anonymousUser})}));n.add("anonymousUser",_().component({post:s,cardVisible:this.cardVisible,oncardshow:function(){o.cardVisible=!0,m.redraw()},oncardhide:function(){o.cardVisible=!1,m.redraw()}}),90)}})),(0,s.extend)(B().prototype,"view",(function(n){a().composer.fields.isAnonymous&&n&&Array.isArray(n.children)&&n.children.forEach((function(n){n&&Array.isArray(n.children)&&n.children.forEach((function(n){n&&Array.isArray(n.children)&&n.children.forEach((function(o,t){o&&Array.isArray(o.children)&&(o.children.forEach((function(n,t){n&&n.attrs&&n.attrs.className&&(-1!==n.attrs.className.indexOf("PostUser-avatar")&&(o.children[t]=q(a().forum,".PostUser-avatar")),"username"===n.attrs.className&&(n.text=a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username")))})),o.attrs&&o.attrs.className&&-1!==o.attrs.className.indexOf("PostUser-badges")&&n.children.splice(t,1))}))}))}))})),(0,s.extend)(L().prototype,"view",(function(n){var o=this.attrs.discussion;o.attribute("isAnonymous")&&n.children.forEach((function(n){n&&n.attrs&&n.attrs.className&&-1!==n.attrs.className.indexOf("DiscussionListItem-content")&&n.children.forEach((function(n){n&&n.tag===k()&&(n.attrs.text=a().translator.trans("core.forum.discussion_list.started_text",{username:a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username"),ago:i()(o.createdAt())}),n.children.forEach((function(n){n&&n.tag===d()&&(n.children=[q(o)])})))}))}))})),(0,s.extend)(U().prototype,"oninit",(function(){var n=this;this.subtree.check((function(){return n.attrs.post.attribute("isAnonymous")}))})),(0,s.extend)(j().prototype,"headerItems",R),(0,s.extend)(j().prototype,"data",H),(0,s.extend)(j().prototype,"view",$),(0,s.extend)(S().prototype,"headerItems",R),(0,s.extend)(S().prototype,"data",H),(0,s.extend)(S().prototype,"view",$),(0,s.extend)(x(),"moderationControls",(function(n,o){o.attribute("canDeAnonymize")&&n.add("deanonymize",p().component({icon:"fas fa-user-secret",onclick:function(){confirm(u()(a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionControls.deanonymizeConfirmation")))&&o.save({isAnonymous:!1}).then((function(){m.redraw()}))}},a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionControls.deanonymize"))),o.attribute("canAnonymize")&&n.add("anonymize",p().component({icon:"fas fa-user-secret",onclick:function(){confirm(u()(a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionControls.anonymizeConfirmation")))&&o.save({isAnonymous:!0}).then((function(){m.redraw()}))}},a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionControls.anonymize")))})),(0,s.extend)(P(),"moderationControls",(function(n,o){o.attribute("canDeAnonymize")&&n.add("deanonymize",p().component({icon:"fas fa-user-secret",onclick:function(){confirm(u()(a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postControls.deanonymizeConfirmation")))&&o.save({isAnonymous:!1}).then((function(){m.redraw()}))}},a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postControls.deanonymize"))),o.attribute("canAnonymize")&&n.add("anonymize",p().component({icon:"fas fa-user-secret",onclick:function(){(1!==o.number()||confirm(u()(a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postControls.firstPostConfirmation"))))&&o.save({isAnonymous:!0}).then((function(){m.redraw()}))}},a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postControls.anonymize")))})),(0,s.override)(M().prototype,"focus",(function(n){var o=this.$(".item-anonymous-posting input");o.prop("disabled",!0);var t=n();return o.prop("disabled",!1),t}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map